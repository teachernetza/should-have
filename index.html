<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Past Modals | Rators Club</title>
    
    <link rel="icon" type="image/png" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128">
    <link rel="apple-touch-icon" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w512">
    <meta name="theme-color" content="#1A2B4C">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* ==========================================================================
           1. RATORS CLUB BRANDING (NAVY & WHITE)
           ========================================================================== */
        :root {
            /* Core Palette */
            --rc-navy: #1A2B4C;       /* Azul Marino Institucional */
            --rc-navy-light: #2A406D; /* Azul Marino Hover */
            --rc-white: #FFFFFF;      /* Blanco Puro */
            --rc-bg: #F5F7FA;         /* Gris muy claro para el fondo */
            --rc-gray: #E2E8F0;       /* Bordes */
            
            /* Text */
            --text-main: #0F172A;
            --text-muted: #64748B;
            
            /* UI Elements */
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
            
            /* Dimensions & Physics */
            --sidebar-width: 280px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --shadow-sm: 0 4px 6px -1px rgba(26, 43, 76, 0.08);
            --shadow-lg: 0 15px 35px -5px rgba(26, 43, 76, 0.15);
            --trans: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--rc-bg);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            display: flex; /* Layout base para Sidebar + Content */
        }

        h1, h2, h3 { font-family: 'Lora', serif; color: var(--rc-navy); }
        p { margin-bottom: 1rem; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--rc-bg); }
        ::-webkit-scrollbar-thumb { background: var(--rc-navy-light); border-radius: 4px; }

        /* ==========================================================================
           2. SIDEBAR (NAVEGACIÓN LATERAL)
           ========================================================================== */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--rc-navy);
            color: var(--rc-white);
            position: fixed;
            top: 0; left: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            transition: transform var(--trans);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .rc-logo {
            width: 100px; height: 100px; margin: 0 auto 1rem;
            border-radius: 50%; border: 4px solid var(--rc-white);
            overflow: hidden; background: var(--rc-white);
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }
        .rc-logo img { width: 100%; height: 100%; object-fit: cover; }
        
        .rc-title { font-size: 1.5rem; font-weight: 800; letter-spacing: 1px; color: var(--rc-white); font-family: 'Poppins'; }
        .rc-subtitle { font-size: 0.85rem; color: #94A3B8; text-transform: uppercase; letter-spacing: 2px; }

        .nav-menu { padding: 2rem 1rem; flex: 1; display: flex; flex-direction: column; gap: 10px; }
        
        .nav-link {
            width: 100%; padding: 15px 20px; border-radius: var(--radius-md);
            background: transparent; border: none; color: #CBD5E1;
            text-align: left; font-size: 1.05rem; font-weight: 500; font-family: 'Poppins';
            cursor: pointer; transition: var(--trans);
            display: flex; align-items: center; gap: 15px;
        }
        .nav-link i { font-size: 1.2rem; width: 24px; text-align: center; }
        .nav-link:hover { background: rgba(255,255,255,0.05); color: var(--rc-white); transform: translateX(5px); }
        .nav-link.active { background: var(--rc-white); color: var(--rc-navy); font-weight: 700; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transform: translateX(5px); }

        .sidebar-footer { padding: 1.5rem; text-align: center; font-size: 0.8rem; color: rgba(255,255,255,0.5); border-top: 1px solid rgba(255,255,255,0.1); }

        /* ==========================================================================
           3. MAIN CONTENT AREA & MOBILE TOGGLE
           ========================================================================== */
        .main-wrapper {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--trans);
        }

        .mobile-header {
            display: none; background: var(--rc-navy); padding: 15px 20px;
            color: var(--rc-white); align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 900; box-shadow: var(--shadow-sm);
        }
        .btn-menu { background: transparent; border: none; color: var(--rc-white); font-size: 1.5rem; cursor: pointer; }

        .content-container { padding: 3rem 2rem; max-width: 900px; margin: 0 auto; width: 100%; flex: 1; }

        /* Overlay for mobile */
        .sidebar-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999;
            display: none; opacity: 0; transition: opacity var(--trans);
        }

        /* Responsive Logic */
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-wrapper { margin-left: 0; width: 100%; }
            .mobile-header { display: flex; }
            .sidebar-overlay.active { display: block; opacity: 1; }
            .content-container { padding: 2rem 1rem; }
        }

        /* ==========================================================================
           4. SECTIONS & CARDS (The Content)
           ========================================================================== */
        .view-section { display: none; animation: fadeIn 0.5s ease forwards; opacity: 0; }
        .view-section.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }

        .card {
            background: var(--rc-white); border-radius: var(--radius-lg); padding: 2.5rem;
            box-shadow: var(--shadow-sm); margin-bottom: 2rem; border: 1px solid var(--rc-gray);
        }
        
        .hero-title { font-size: 2.8rem; line-height: 1.2; margin-bottom: 1rem; color: var(--rc-navy); }
        .hero-divider { width: 60px; height: 5px; background: var(--rc-navy); border-radius: 5px; margin-bottom: 2rem; }

        /* Tab 1: Objectives List */
        .obj-list { list-style: none; display: flex; flex-direction: column; gap: 15px; margin-top: 1.5rem; }
        .obj-item { display: flex; align-items: flex-start; gap: 15px; font-size: 1.1rem; }
        .obj-icon { background: var(--rc-bg); color: var(--rc-navy); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }

        /* Tab 2: Theory Boxes */
        .theory-box { background: var(--rc-bg); border-left: 5px solid var(--rc-navy); padding: 20px 25px; border-radius: 0 var(--radius-md) var(--radius-md) 0; margin-bottom: 20px; }
        .formula { font-family: monospace; font-size: 1.2rem; font-weight: 700; color: var(--rc-white); background: var(--rc-navy); padding: 10px 15px; border-radius: 8px; display: inline-block; margin: 10px 0; letter-spacing: 1px; }
        .example-en { font-weight: 700; color: var(--rc-navy); font-size: 1.1rem; }
        .example-es { color: var(--text-muted); font-style: italic; font-size: 0.95rem; }

        /* Verbs Table */
        .verb-table-wrapper { overflow-x: auto; border-radius: var(--radius-md); border: 1px solid var(--rc-gray); margin-top: 2rem; }
        .verb-table { width: 100%; border-collapse: collapse; text-align: left; }
        .verb-table th { background: var(--rc-navy); color: var(--rc-white); padding: 15px; font-weight: 600; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
        .verb-table td { padding: 15px; border-bottom: 1px solid var(--rc-gray); color: var(--text-main); font-weight: 500; }
        .verb-table tr:nth-child(even) { background: var(--rc-bg); }
        .highlight-v3 { color: var(--rc-navy); font-weight: 800; }

        /* ==========================================================================
           5. PRACTICE LAB (TTS AUDIO)
           ========================================================================== */
        .audio-item {
            display: flex; align-items: center; gap: 20px; padding: 15px 20px;
            border-bottom: 1px solid var(--rc-gray); transition: 0.2s;
        }
        .audio-item:hover { background: var(--rc-bg); border-radius: var(--radius-md); }
        .audio-item:last-child { border-bottom: none; }
        
        .btn-play {
            width: 50px; height: 50px; border-radius: 50%; border: none;
            background: var(--rc-navy); color: var(--rc-white); font-size: 1.2rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-sm); transition: 0.2s; flex-shrink: 0;
        }
        .btn-play:active { transform: scale(0.9); }
        .btn-play.playing { animation: pulseNavy 1.5s infinite; background: var(--success); }

        @keyframes pulseNavy { 0% { box-shadow: 0 0 0 0 rgba(26,43,76,0.5); } 70% { box-shadow: 0 0 0 15px rgba(26,43,76,0); } 100% { box-shadow: 0 0 0 0 rgba(26,43,76,0); } }

        /* ==========================================================================
           6. EXAM ENGINE
           ========================================================================== */
        .exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--rc-gray); }
        .exam-stat { font-weight: 800; color: var(--rc-navy); font-size: 1.2rem; background: var(--rc-bg); padding: 5px 15px; border-radius: 20px; }
        
        .progress-track { flex: 1; height: 10px; background: var(--rc-gray); border-radius: 5px; margin: 0 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--rc-navy); width: 0%; transition: width 0.4s ease; }

        .q-display { display: none; animation: slideLeft 0.3s ease; }
        .q-display.active { display: block; }
        @keyframes slideLeft { from {opacity:0; transform:translateX(20px);} to {opacity:1; transform:translateX(0);} }

        .question-title { font-size: 1.4rem; font-weight: 600; color: var(--text-main); margin-bottom: 2rem; line-height: 1.5; }
        
        /* Multiple Choice Grid */
        .mc-grid { display: grid; gap: 12px; margin-bottom: 2rem; }
        .mc-btn {
            width: 100%; padding: 18px 20px; border-radius: var(--radius-md); border: 2px solid var(--rc-gray);
            background: var(--rc-white); color: var(--text-main); font-size: 1.1rem; font-family: 'Poppins';
            text-align: left; cursor: pointer; font-weight: 500; transition: 0.2s;
        }
        .mc-btn:hover { border-color: var(--rc-navy); background: var(--rc-bg); }
        .mc-btn.selected { border-color: var(--rc-navy); background: var(--rc-navy); color: var(--rc-white); font-weight: 700; }
        .mc-btn.correct { border-color: var(--success); background: var(--success); color: white; }
        .mc-btn.wrong { border-color: var(--error); background: var(--error); color: white; }

        /* Typing Input */
        .type-input {
            width: 100%; padding: 20px; border-radius: var(--radius-md); border: 2px solid var(--rc-navy);
            font-size: 1.2rem; font-weight: 700; color: var(--rc-navy); text-align: center;
            font-family: 'Poppins'; margin-bottom: 2rem; outline: none;
        }
        .type-input.correct-ans { border-color: var(--success); color: var(--success); background: rgba(16,185,129,0.1); }
        .type-input.wrong-ans { border-color: var(--error); color: var(--error); background: rgba(239,68,68,0.1); }

        .btn-action {
            width: 100%; padding: 18px; border-radius: var(--radius-md); border: none;
            background: var(--rc-navy); color: var(--rc-white); font-size: 1.1rem; font-weight: 800;
            cursor: pointer; transition: 0.2s; box-shadow: var(--shadow-sm); letter-spacing: 1px;
        }
        .btn-action:disabled { background: var(--rc-gray); color: var(--text-muted); cursor: not-allowed; box-shadow: none; }
        .btn-action:hover:not(:disabled) { background: var(--rc-navy-light); transform: translateY(-2px); box-shadow: var(--shadow-lg); }

        /* ==========================================================================
           7. FOOTER & MODALS
           ========================================================================== */
        .rc-footer {
            background: var(--rc-navy); color: var(--rc-white); padding: 3rem 2rem;
            text-align: center; margin-top: auto; border-top: 5px solid rgba(255,255,255,0.1);
        }
        .footer-badge { display: inline-block; padding: 5px 12px; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-family: monospace; font-size: 0.8rem; margin-top: 15px; opacity: 0.8; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(26,43,76,0.9); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .modal-box { background: var(--rc-white); width: 100%; max-width: 450px; padding: 3rem 2rem; border-radius: var(--radius-lg); text-align: center; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .score-circle {
            width: 130px; height: 130px; border-radius: 50%; border: 8px solid var(--rc-navy);
            display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;
            font-size: 2.8rem; font-weight: 800; color: var(--rc-navy); font-family: 'Poppins';
        }

    </style>
</head>
<body>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="rc-logo">
                <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w200" alt="Rators Club Logo" onerror="this.src='https://via.placeholder.com/200x200.png?text=RC'">
            </div>
            <div class="rc-title">RATORS CLUB</div>
            <div class="rc-subtitle">Grammar Lab</div>
        </div>

        <nav class="nav-menu">
            <button class="nav-link active" onclick="navTo('welcome', this)"><i class="fas fa-flag-checkered"></i> 1. Welcome</button>
            <button class="nav-link" onclick="navTo('theory', this)"><i class="fas fa-book-open"></i> 2. The Theory</button>
            <button class="nav-link" onclick="navTo('practice', this)"><i class="fas fa-headphones"></i> 3. Audio Lab</button>
            <button class="nav-link" onclick="navTo('test', this)"><i class="fas fa-laptop-code"></i> 4. Final Test</button>
        </nav>

        <div class="sidebar-footer">
            <i class="fas fa-shield-alt"></i> Secure Environment
        </div>
    </aside>

    <main class="main-wrapper">
        
        <header class="mobile-header">
            <div style="font-weight:800; letter-spacing:1px;">RATORS CLUB</div>
            <button class="btn-menu" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        </header>

        <div class="content-container">

            <section id="welcome" class="view-section active">
                <div class="card" style="border-top: 8px solid var(--rc-navy);">
                    <h1 class="hero-title">Past Modals of Regret</h1>
                    <div class="hero-divider"></div>
                    
                    <p style="font-size: 1.1rem; color: var(--text-muted); margin-bottom: 2rem;">
                        Bienvenido al laboratorio avanzado del <strong>Rators Club</strong>. Hoy dominaremos una de las estructuras más elegantes y útiles del idioma inglés: <em>Should have</em> y <em>Shouldn't have</em>.
                    </p>

                    <h3><i class="fas fa-bullseye" style="color:var(--rc-navy);"></i> Objetivos de esta lección:</h3>
                    <ul class="obj-list">
                        <li class="obj-item">
                            <div class="obj-icon"><i class="fas fa-brain"></i></div>
                            <div>
                                <strong>Comprender el uso (Regret & Criticism)</strong><br>
                                <span style="font-size:0.95rem; color:var(--text-muted);">Aprenderás a expresar arrepentimiento sobre el pasado y a criticar acciones que ya sucedieron.</span>
                            </div>
                        </li>
                        <li class="obj-item">
                            <div class="obj-icon"><i class="fas fa-layer-group"></i></div>
                            <div>
                                <strong>Dominar la Estructura (V3)</strong><br>
                                <span style="font-size:0.95rem; color:var(--text-muted);">Entenderás por qué siempre necesitamos usar el Verbo en Pasado Participio.</span>
                            </div>
                        </li>
                        <li class="obj-item">
                            <div class="obj-icon"><i class="fas fa-microphone-alt"></i></div>
                            <div>
                                <strong>Pronunciación Nativa (Connected Speech)</strong><br>
                                <span style="font-size:0.95rem; color:var(--text-muted);">Aprenderás a escuchar y pronunciar las contracciones "should've" y "shouldn't've".</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>

            <section id="theory" class="view-section">
                <div class="card">
                    <h2 style="font-size:2rem; margin-bottom:1.5rem;">The Theory Behind It</h2>
                    <p>En español decimos "Debí haber hecho esto" o "No debiste haber dicho eso". En inglés, la fórmula es matemática e inquebrantable.</p>

                    <div class="theory-box">
                        <h3>1. Regret (Arrepentimiento personal)</h3>
                        <p style="margin-bottom:5px;">Usamos la forma afirmativa para decir que una buena idea <strong>no se hizo</strong> en el pasado.</p>
                        <div class="formula">Subject + should have + Verb (V3)</div>
                        <div style="margin-top:15px;">
                            <div class="example-en"><i class="fas fa-check" style="color:var(--success);"></i> I should have studied for the test.</div>
                            <div class="example-es">Debí haber estudiado para el examen. (Pero no lo hice, y reprobé).</div>
                        </div>
                    </div>

                    <div class="theory-box" style="border-left-color: var(--error);">
                        <h3 style="color: var(--error);">2. Criticism (Crítica / Regaño)</h3>
                        <p style="margin-bottom:5px;">Usamos la forma negativa para decir que una mala idea <strong>sí se hizo</strong> en el pasado.</p>
                        <div class="formula" style="background:var(--error); color:white;">Subject + shouldn't have + Verb (V3)</div>
                        <div style="margin-top:15px;">
                            <div class="example-en"><i class="fas fa-times" style="color:var(--error);"></i> You shouldn't have lied to her.</div>
                            <div class="example-es">No debiste haberle mentido. (Lo hiciste, y fue un error).</div>
                        </div>
                    </div>

                    <h3 style="margin-top:3rem; margin-bottom:1rem;"><i class="fas fa-table"></i> The V3 Challenge (Past Participles)</h3>
                    <p>El error más común es usar el verbo en pasado simple en lugar del participio. Memoriza estos esenciales para el Rators Club:</p>
                    
                    <div class="verb-table-wrapper">
                        <table class="verb-table">
                            <thead>
                                <tr><th>Base Verb (V1)</th><th>Past Simple (V2)</th><th>Past Participle (V3)</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Go</td><td>Went</td><td class="highlight-v3">Gone</td></tr>
                                <tr><td>See</td><td>Saw</td><td class="highlight-v3">Seen</td></tr>
                                <tr><td>Do</td><td>Did</td><td class="highlight-v3">Done</td></tr>
                                <tr><td>Speak</td><td>Spoke</td><td class="highlight-v3">Spoken</td></tr>
                                <tr><td>Take</td><td>Took</td><td class="highlight-v3">Taken</td></tr>
                                <tr><td>Write</td><td>Wrote</td><td class="highlight-v3">Written</td></tr>
                                <tr><td>Buy</td><td>Bought</td><td class="highlight-v3">Bought</td></tr>
                                <tr><td>Eat</td><td>Ate</td><td class="highlight-v3">Eaten</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="practice" class="view-section">
                <div class="card">
                    <h2 style="font-size:2rem; margin-bottom:1rem;">Audio Laboratory</h2>
                    <p style="color:var(--text-muted); margin-bottom:2rem;">Haz clic en el botón de Play. Presta atención a cómo el motor de voz contrae el "should have" a "should've". Repítelo en voz alta.</p>
                    
                    <div id="audio-container" style="display:flex; flex-direction:column; gap:5px;">
                        </div>
                </div>
            </section>

            <section id="test" class="view-section">
                <div class="card" id="test-welcome">
                    <div style="text-align:center; padding:2rem 0;">
                        <i class="fas fa-file-signature" style="font-size:4rem; color:var(--rc-navy); margin-bottom:20px;"></i>
                        <h2 style="font-size:2.2rem; margin-bottom:15px;">Certification Test</h2>
                        <p style="max-width:500px; margin:0 auto 30px; font-size:1.1rem; color:var(--text-muted);">
                            20 Reactivos. Selección múltiple y escritura. Demuestra tu nivel Rators Club.
                        </p>
                        <button class="btn-action" style="max-width: 300px; margin:0 auto;" onclick="startQuiz()">
                            COMENZAR EXAMEN <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div class="card" id="test-engine" style="display:none; padding:3rem;">
                    <div class="exam-header">
                        <div class="exam-stat" id="ui-progress">1 / 20</div>
                        <div class="progress-track"><div class="progress-fill" id="ui-bar"></div></div>
                        <div class="exam-stat" style="color:var(--text-muted); background:none;" id="ui-score">0 pts</div>
                    </div>

                    <div id="quiz-area" style="min-height:250px;">
                        </div>

                    <button class="btn-action" id="btn-submit" onclick="submitQuestion()" disabled>CHECK ANSWER</button>
                </div>
            </section>

        </div> <footer class="rc-footer">
            <h3 style="color:white; font-family:'Poppins'; margin-bottom:10px;">RATORS CLUB</h3>
            <p style="font-size:0.9rem; opacity:0.8; max-width:600px; margin:0 auto 20px;">
                Designed & Engineered for exclusive grammar mastery.
            </p>
            <div style="margin-bottom:20px;">
                <i class="fab fa-html5" style="font-size:1.5rem; margin:0 10px;"></i>
                <i class="fab fa-css3-alt" style="font-size:1.5rem; margin:0 10px;"></i>
                <i class="fab fa-js" style="font-size:1.5rem; margin:0 10px;"></i>
            </div>
            <p style="font-size:0.8rem; opacity:0.6; margin:0;">
                &copy; 2026 Netza Creation. All rights reserved.
            </p>
            <div class="footer-badge">GNU General Public License v3.0</div>
        </footer>

    </main>

    <div class="modal-overlay" id="resultModal">
        <div class="modal-box">
            <h2 style="font-size:2rem; margin-bottom:20px;" id="modalTitle">Test Complete</h2>
            <div class="score-circle" id="modalScore">100%</div>
            <p id="modalMsg" style="font-size:1.1rem; color:var(--text-muted); margin-bottom:30px;">Mensaje de evaluación</p>
            <button class="btn-action" onclick="location.reload()"><i class="fas fa-redo"></i> RETAKE EXAM</button>
        </div>
    </div>

    <script>
        // --- 1. DATOS DE AUDIO (15 Oraciones) ---
        const audioDB = [
            { en: "I should have woken up earlier.", es: "Debí haberme despertado más temprano." },
            { en: "You shouldn't have eaten all the pizza.", es: "No debiste haberte comido toda la pizza." },
            { en: "She should have told me the truth.", es: "Ella debió haberme dicho la verdad." },
            { en: "We shouldn't have bought this old car.", es: "No debimos haber comprado este auto viejo." },
            { en: "He should have studied for the test.", es: "Él debió haber estudiado para el examen." },
            { en: "They shouldn't have left without us.", es: "No debieron haberse ido sin nosotros." },
            { en: "I should have taken a taxi.", es: "Debí haber tomado un taxi." },
            { en: "You shouldn't have spent so much money.", es: "No debiste haber gastado tanto dinero." },
            { en: "She should have worn a jacket.", es: "Ella debió haber usado una chamarra." },
            { en: "We should have made a reservation.", es: "Debimos haber hecho una reservación." },
            { en: "He shouldn't have quit his job.", es: "Él no debió haber renunciado a su trabajo." },
            { en: "I should have listened to my mother.", es: "Debí haber escuchado a mi madre." },
            { en: "You shouldn't have driven in the snow.", es: "No debiste haber conducido en la nieve." },
            { en: "They should have invited him to the party.", es: "Debieron haberlo invitado a la fiesta." },
            { en: "Should I have brought a gift?", es: "¿Debí haber traído un regalo?" }
        ];

        // --- 2. DATOS DEL EXAMEN (20 Reactivos: 10 MC, 10 Typing) ---
        const quizDB = [
            // Multiple Choice
            { type: "mc", q: "I'm so tired. I _____ gone to bed earlier.", opts: ["should have", "shouldn't have", "should go"], ans: 0 },
            { type: "mc", q: "You missed the train. You _____ left the house at 8:00.", opts: ["shouldn't have", "should have", "should left"], ans: 1 },
            { type: "mc", q: "She feels sick. She _____ eaten that seafood.", opts: ["should have", "shouldn't have", "should not"], ans: 1 },
            { type: "mc", q: "We are lost. We _____ brought the GPS.", opts: ["should have", "shouldn't have", "should brought"], ans: 0 },
            { type: "mc", q: "He failed the test. He _____ played video games all night.", opts: ["should have", "shouldn't have", "shouldn't had"], ans: 1 },
            { type: "mc", q: "My phone is dead. I _____ charged it.", opts: ["should charge", "shouldn't have", "should have"], ans: 2 },
            { type: "mc", q: "You got a ticket! You _____ parked there.", opts: ["should have", "shouldn't have", "should parking"], ans: 1 },
            { type: "mc", q: "They didn't understand the movie. They _____ read the book first.", opts: ["should have", "shouldn't have", "should read"], ans: 0 },
            { type: "mc", q: "I burned my hand. I _____ touched the stove.", opts: ["should have", "shouldn't have", "shouldn't touched"], ans: 1 },
            { type: "mc", q: "The hotel was terrible. We _____ stayed there.", opts: ["should have", "shouldn't have", "shouldn't had"], ans: 1 },
            // Typing (Past Participles)
            { type: "type", q: "I should have _____ (do) my homework.", ans: ["done"] },
            { type: "type", q: "She shouldn't have _____ (buy) that dress.", ans: ["bought"] },
            { type: "type", q: "We should have _____ (go) to the doctor.", ans: ["gone"] },
            { type: "type", q: "You shouldn't have _____ (drink) the milk.", ans: ["drunk"] },
            { type: "type", q: "He should have _____ (write) an email.", ans: ["written"] },
            { type: "type", q: "They shouldn't have _____ (take) my keys.", ans: ["taken"] },
            { type: "type", q: "I should have _____ (speak) to the manager.", ans: ["spoken"] },
            { type: "type", q: "She shouldn't have _____ (forget) the password.", ans: ["forgotten"] },
            { type: "type", q: "We should have _____ (see) that movie.", ans: ["seen"] },
            { type: "type", q: "You shouldn't have _____ (give) him money.", ans: ["given"] }
        ];

        // --- 3. ESTADOS GLOBALES ---
        let quizState = { active: false, index: 0, score: 0, selectedOpt: null, answered: false };

        // --- 4. MOTOR TTS (AUDIO) ---
        const synth = window.speechSynthesis;
        let engVoice = null;

        function initVoices() {
            const voices = synth.getVoices();
            engVoice = voices.find(v => v.lang.includes('en-US') && v.name.includes('Google')) || voices.find(v => v.lang.includes('en-US'));
        }
        if (speechSynthesis.onvoiceschanged !== undefined) { speechSynthesis.onvoiceschanged = initVoices; }

        function playSound(text, btnElement) {
            if (synth.speaking) synth.cancel();
            const u = new SpeechSynthesisUtterance(text);
            if (engVoice) u.voice = engVoice;
            u.lang = 'en-US'; u.rate = 0.85; // Velocidad perfecta para alumnos
            
            u.onstart = () => {
                document.querySelectorAll('.btn-play').forEach(b => b.classList.remove('playing'));
                btnElement.classList.add('playing');
            };
            u.onend = () => btnElement.classList.remove('playing');
            synth.speak(u);
        }

        // Renderizar Lista de Audios
        function renderAudios() {
            const container = document.getElementById('audio-container');
            let html = '';
            audioDB.forEach((item) => {
                html += `
                <div class="audio-item">
                    <button class="btn-play" onclick="playSound('${item.en.replace(/'/g, "\\'")}', this)"><i class="fas fa-play"></i></button>
                    <div>
                        <div style="font-size:1.1rem; font-weight:700; color:var(--rc-navy); font-family:'Lora';">${item.en}</div>
                        <div style="font-size:0.9rem; color:var(--text-muted); font-style:italic;">${item.es}</div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // --- 5. LÓGICA DE INTERFAZ (SIDEBAR & TABS) ---
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        function navTo(tabId, btnElement) {
            // UI Sidebar active states
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            btnElement.classList.add('active');

            // Hide all sections, show target
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // Close sidebar on mobile
            if(window.innerWidth <= 992) toggleSidebar();
            
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // --- 6. MOTOR DEL EXAMEN ---
        function startQuiz() {
            document.getElementById('test-welcome').style.display = 'none';
            document.getElementById('test-engine').style.display = 'block';
            quizState = { active: true, index: 0, score: 0, selectedOpt: null, answered: false };
            renderQuestion();
        }

        function renderQuestion() {
            const q = quizDB[quizState.index];
            const area = document.getElementById('quiz-area');
            const btn = document.getElementById('btn-submit');
            
            quizState.answered = false;
            quizState.selectedOpt = null;
            btn.innerText = "CHECK ANSWER";
            btn.disabled = true;

            // UI Progress
            document.getElementById('ui-progress').innerText = `${quizState.index + 1} / ${quizDB.length}`;
            document.getElementById('ui-score').innerText = `${quizState.score} pts`;
            document.getElementById('ui-bar').style.width = `${((quizState.index) / quizDB.length) * 100}%`;

            let html = `<div class="q-display active"><div class="question-title">${quizState.index + 1}. ${q.q}</div>`;

            if (q.type === 'mc') {
                html += `<div class="mc-grid">`;
                q.opts.forEach((opt, i) => {
                    html += `<button class="mc-btn" onclick="selectMC(${i}, this)">${opt}</button>`;
                });
                html += `</div>`;
            } else {
                html += `<input type="text" id="type-ans" class="type-input" placeholder="Type past participle..." autocomplete="off" oninput="checkTypeInput()">`;
            }
            html += `</div>`;
            area.innerHTML = html;
        }

        function selectMC(idx, btnElement) {
            if(quizState.answered) return;
            document.querySelectorAll('.mc-btn').forEach(b => b.classList.remove('selected'));
            btnElement.classList.add('selected');
            quizState.selectedOpt = idx;
            document.getElementById('btn-submit').disabled = false;
        }

        function checkTypeInput() {
            if(quizState.answered) return;
            const val = document.getElementById('type-ans').value.trim();
            document.getElementById('btn-submit').disabled = val.length === 0;
        }

        function submitQuestion() {
            const q = quizDB[quizState.index];
            const btn = document.getElementById('btn-submit');

            if (!quizState.answered) {
                // FASE 1: EVALUAR
                quizState.answered = true;
                let isCorrect = false;

                if (q.type === 'mc') {
                    const btns = document.querySelectorAll('.mc-btn');
                    if (quizState.selectedOpt === q.ans) {
                        isCorrect = true;
                        btns[quizState.selectedOpt].classList.add('correct');
                    } else {
                        btns[quizState.selectedOpt].classList.add('wrong');
                        btns[q.ans].classList.add('correct');
                    }
                } else {
                    const input = document.getElementById('type-ans');
                    const userVal = input.value.trim().toLowerCase();
                    input.readOnly = true;
                    if (q.ans.includes(userVal)) {
                        isCorrect = true;
                        input.classList.add('correct-ans');
                    } else {
                        input.classList.add('wrong-ans');
                        input.value = `${input.value} ❌ (Ans: ${q.ans[0]})`;
                    }
                }

                if (isCorrect) quizState.score++;
                
                btn.innerText = (quizState.index === quizDB.length - 1) ? "FINISH EXAM" : "NEXT QUESTION";

            } else {
                // FASE 2: AVANZAR
                quizState.index++;
                if (quizState.index < quizDB.length) {
                    renderQuestion();
                } else {
                    finishQuiz();
                }
            }
        }

        function finishQuiz() {
            document.getElementById('ui-bar').style.width = '100%';
            const pct = Math.round((quizState.score / quizDB.length) * 100);
            
            const modal = document.getElementById('resultModal');
            const circle = document.getElementById('modalScore');
            const msg = document.getElementById('modalMsg');

            circle.innerText = `${pct}%`;

            if (pct >= 80) {
                circle.style.borderColor = "var(--success)";
                circle.style.color = "var(--success)";
                msg.innerText = `¡Certificación aprobada! Eres oficialmente un miembro distinguido del Rators Club.`;
                confetti({ particleCount: 200, spread: 90, origin: { y: 0.5 } });
            } else {
                circle.style.borderColor = "var(--error)";
                circle.style.color = "var(--error)";
                msg.innerText = `Obtuviste ${quizState.score} de ${quizDB.length}. El Rators Club exige excelencia (80%). Debes repasar la teoría y volver a intentarlo.`;
            }

            modal.style.display = 'flex';
        }

        // --- 7. ARRANQUE DE LA APP ---
        window.onload = () => {
            initVoices();
            renderAudios();
        };

    </script>
</body>
</html>
